---
description: How to Connect DataDistillr to the VirusTotal API
---

# Connecting to VirusTotal

## First Steps with VirusTotal
Set up an account with [VirusTotal](https://www.virustotal.com/gui/join-us){target=_blank}.

???+ cost "Cost"

    There is a free version and a [paid](https://www.virustotal.com/gui/contact-us/premium-services){target=_blank} version. 


???+ rlimit "Rate Limits"

    With the free version the API is [rate limited](https://developers.virustotal.com/reference/public-vs-premium-api){target=_blank}.

## How to Connect DataDistillr to VirusTotal
To set up a data source connection for VirusTotal, you will need to have:

- A unique [name](#name) for your data source connection to be used in queries.
- The [API Key](#api-key) generated by VirusTotal.



### Data Source Form

To locate the VirusTotal form, follow the steps in [Connecting Your Data to DataDistillr](../../). When you get to the window to choose the data source type, select API as shown below.&#x20;

![Select API from the available choices][image-5]

On the API screen, select VirusTotal from list of API forms as shown in the image below.

![Select VirusTotal API from available choices][image-6]

The following form will appear. Instructions can be found below on how to find the information required to fill each field on the VirusTotal API form.

Once you have filled out all the fields, press the green 'Save' button, and your API will be connected!

![VirusTotal Form][image-1]

### Name

Enter any name that will help you recognize this data source from within your query window. &#x20;

!!! info "Acceptable characters include"

    * lowercase alphanumeric characters
    * underscores

### API Key

=== "1. Find your API Key"

    From your VirusTotal home page open the menu in the to right hand corner and click on "API Keys" tab in the menu
    ![Sign in][image-8]

=== "2. Copy your API Key"

    Highlight and copy your API Key
    ![Copy API Key][image-7]


## Endpoints

The table below shows a list of endpoints available to connect to within the DataDistillr application. If you need to connect to any endpoints not listed in the table below, please use the [Custom API](custom-apis.md) Form.

| Endpoint      | Required Params | Optional  Params   | Description                              |
|---------------|-----------------|--------------------|------------------------------------------|
| `collections` |                 | relationships      |  |
| `metrics`     | from            | host<br>tag_filter | Returns active Metrics list.             |
| `events`      | start<br>end    |                    | This endpoint queries the event stream.  |


### Nav Tree

The endpoint above will display as follows in the nav tree once your API has successfully connected.

![Datadog Endpoints][image-3]

## Sample Queries

The following queries are intended to help you get started, and make life simpler querying within your API.

For the following examples, suppose that my Datadog data source was called `mydatadog` and I want to query an endpoint. The endpoint goes after the Datadog data source name:

!!! example "FROM Clause"

    ```sql
    FROM `mydatadog`.`<ENDPOINT>`
    ```

### Get Synthetics Endpoint

Get the list of all Synthetic tests. This endpoint requires the Datadog `synthetics_read` authorization scope.

```sql
SELECT * FROM `mydatadog`.`synthetics`
WHERE public_id = '<PUBLIC_ID>'
LIMIT 1000
```

### Get Metrics Endpoint

Get the list of actively reporting metrics from a given time until now. This endpoint requires the `metrics_read` authorization scope.

```sql
SELECT * FROM `mydatadog`.`metrics`
WHERE from = '1643111571'
LIMIT 1000
```

### Get Events Endpoint

The event stream can be queried and filtered by time, priority, sources and tags.

```sql
SELECT * FROM `mydatadog`.`synthetics`
WHERE start=1641071432 AND end=1643521168
LIMIT 1000
```


[image-1]: ../../img/api/virustotal/virustotal-form.png
[image-2]: ../../img/api/datadog/datadog-application-key.png
[image-3]: ../../img/api/datadog/datadog-endpoints.png
[image-4]: ../../img/api/datadog/datadog-api.png
[image-5]: ../../img/api/add-api.png
[image-6]: ../../img/api/virustotal/virustotal-select.png
[image-7]: ../../img/api/virustotal/virustotal-api.png
[image-8]: ../../img/api/virustotal/virustotal-api-nav.png
